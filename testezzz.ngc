%
;
; Projeto: fazer fresa para PCI na router CNC
; Inicial: 27/jan/2019
; correcoes 30/jan/2019
; reformulacao 31/jan/2019
;

;
; Rotina de desbaste
;
o100 sub
   #30 = #6;
   #25 = [[#3 - #1] / SQRT[[#3 - #1] * [#3 - #1] + [#4 - #2] * [#4 - #2]]] ; Cos(alpha)
   #26 = [[#4 - #2] / SQRT[[#3 - #1] * [#3 - #1] + [#4 - #2] * [#4 - #2]]] ; Sen(alpha)
   #21 = [#1 + [#5 + #6] * #26] ; Ax'= Ax + D * SIN(alpha)
   #22 = [#2 - [#5 + #6] * #25] ; Ay'= Ay + D * COS(alpha)
   G00 z#09
   G00 x#21 y#22
   G01 z#10 F[#7/2]
   o101 while [#30 GE 0.0]
      #21 = [#1 + [#5 + #30] * #26] ; Ax'= Ax + D * SIN(alpha)
      #22 = [#2 - [#5 + #30] * #25] ; Ay'= Ay + D * COS(alpha)
      #23 = [#3 + [#5 + #30] * #26] ; Bx'= Bx + D * SIN(alpha)
      #24 = [#4 - [#5 + #30] * #25] ; By'= Bx + D * COS(alpha)
      G01 x#21 y#22
      G01 x#23 y#24
      G01 x#21 y#22
      #30 = [#30 - #8]
   o101 endwhile
   #21 = [#1 + [#5 + #6] * #26] ; Ax'= Ax + D * SIN(alpha)
   #22 = [#2 - [#5 + #6] * #25] ; Ay'= Ay + D * COS(alpha)
   G00 x#21 y#22
   G00 z#09
o100 endsub

;
; Rotina de desbaste e acabamento
;
o200 sub
   #30 = #6;
   #25= [[#3 - #1] / SQRT[[#3 - #1] * [#3 - #1] + [#4 - #2] * [#4 - #2]]] ; Cos(alpha)
   #26= [[#4 - #2] / SQRT[[#3 - #1] * [#3 - #1] + [#4 - #2] * [#4 - #2]]] ; Sen(alpha)
   #21 = [#1 + [#5 + #6] * #26] ; Ax'= Ax + D * SIN(alpha)
   #22 = [#2 - [#5 + #6] * #25] ; Ay'= Ay + D * COS(alpha)
   G00 z#09
   G00 x#21 y#22
   G01 z#10 F[#7/2]
   o201 while [#30 GT #11]
      #21 = [#1 + [#5 + #30] * #26] ; Ax'= Ax + D * SIN(alpha)
      #22 = [#2 - [#5 + #30] * #25] ; Ay'= Ay + D * COS(alpha)
      #23 = [#3 + [#5 + #30] * #26] ; Bx'= Bx + D * SIN(alpha)
      #24 = [#4 - [#5 + #30] * #25] ; By'= Bx + D * COS(alpha)
      G01 x#21 y#22
      G01 x#23 y#24
      G01 x#21 y#22
      #30 = [#30 - #8]
   o201 endwhile
   #21 = [#1 + [#5 + #30 + #8] * #26] ; Ax'= Ax + D * SIN(alpha)
   #22 = [#2 - [#5 + #30 + #8] * #25] ; Ay'= Ay + D * COS(alpha)
   G00 x#21 y#22
   G00 z#09

   #21 = [[#1 + #3] / 2 + [#5 + #30] * #26] ; Mx'= (Ax + Bx) + D * SIN(alpha)
   #22 = [[#2 + #4] / 2 - [#5 + #30] * #25] ; My'= (Ay + By) + D * COS(alpha)
   #23 = SQRT[[#3 - #1] * [#3 - #1] + [#4 - #2] * [#4 - #2]]
   #24 = -[[#5 / 2] * [1 - SQRT[1 - #23 * #23 / #5 / #5]]] ; calculo de profundidade
   G01 x#21 y#22

   o202 while [#30 GE #24]
      #21 = [[#1 + #3] / 2 + [#5 + #30] * #26] ; Ax'= Ax + D * SIN(alpha)
      #22 = [[#2 + #4] / 2 - [#5 + #30] * #25] ; Ay'= Ay + D * COS(alpha)
      G01 z0
      G01 x#21 y#22
      G01 z#10 F#7
      #30 = [#30 - #8]
   o202 endwhile
   #21 = [[#1 + #3] / 2 + #5 * #26] ; Ax'= Ax + D * SIN(alpha)
   #22 = [[#2 + #4] / 2 - #5 * #25] ; Ay'= Ay + D * COS(alpha)
;   #21 = [[#1 + #3] / 2 + [#5 + #30] * #26] ; Mx'= (Ax + Bx) + D * SIN(alpha)
;   #22 = [[#2 + #4] / 2 - [#5 + #30] * #25] ; My'= (Ay + By) + D * COS(alpha)
   G01 z0
   G01 x#21 y#22
   G01 z#10 F[#7/2]
   G01 z#09
o200 endsub

G21 G90

#100= 2; Ax coordenada x do ponto A (#1)
#101= 2; Ay coordenada y do ponto A (#2)
#102= 2.5; Bx coordenada x do ponto B (#3)
#103= 2; By coordenada y do ponto B (#4)
#104= 10; D diametro da ferramenta (#5)
#105= 1; d distancia do material a ser usinado(#6)
#106= 500; F velocidade de avanco (#7)
#107= 0.1; i profundidade de corte(#8)
#108= 2; h altura de movimentacao da ferramenta(#9)
#109= -0.7; profundidade da usinagem(#10)
#110= 0.5 ; s sobrematerial entre as fases de desbaste e acabamento

;o100 call [#100] [#101] [#102] [#103] [#104] [#105] [#106] [#107] [#108] [#109]
o200 call [#100] [#101] [#102] [#103] [#104] [#105] [#106] [#107] [#108] [#109] [#110]

#100= 7.5; Ax coordenada x do ponto A (#1)
#101= 7.5; Ay coordenada y do ponto A (#2)
#102= 8; Bx coordenada x do ponto B (#3)
#103= 8; By coordenada y do ponto B (#4)
#104= 10; D (#5)
#105= 2; d (#6)
#106= 1000; F (#7)
#107= 0.1; i (#8)
#108= 2; h (#9)
#109= -0.6; (#10)
#110= 0.2 ; s sobrematerial entre as fases de desbaste e acabamento

;o100 call [#100] [#101] [#102] [#103] [#104] [#105] [#106] [#107] [#108] [#109]
o200 call [#100] [#101] [#102] [#103] [#104] [#105] [#106] [#107] [#108] [#109] [#110]

#100= 2; Ax coordenada x do ponto A (#1)
#101= 2.5; Ay coordenada y do ponto A (#2)
#102= 3; Bx coordenada x do ponto B (#3)
#103= 3; By coordenada y do ponto B (#4)
#104= 10; D (#5)
#105= 2; d (#6)
#106= 1000; F (#7)
#107= 0.1; i (#8)
#108= 2; h (#9)
#109= -1; (#10)
#110= 0.6 ; s sobrematerial entre as fases de desbaste e acabamento

;o100 call [#100] [#101] [#102] [#103] [#104] [#105] [#106] [#107] [#108] [#109]
o200 call [#100] [#101] [#102] [#103] [#104] [#105] [#106] [#107] [#108] [#109] [#110]

m2